spring:
  application:
    name: mercenary-ai
  profiles:
    active: ${APP_PROFILE:dev}

  # =================================================================
  # CRITICAL SECURITY WARNING
  # =================================================================
  # DO NOT COMMIT REAL CREDENTIALS TO THIS FILE.
  # THIS FILE IS PUBLICLY VISIBLE IN GIT HISTORY.
  #
  # USE ENVIRONMENT VARIABLES FOR ALL SECRETS.
  # 
  # MONGODB_URI should be set in your run configuration or OS environment.
  # Example: MONGODB_URI=mongodb+srv://user:pass@cluster.mongodb.net/mercenary
  # =================================================================

  # --- THE BAN HAMMER ---
  # This tells Spring: "Do NOT load your default MongoDB Vector Store logic. I have my own."
  autoconfigure:
    exclude: org.springframework.ai.autoconfigure.vectorstore.mongo.MongoDBAtlasVectorStoreAutoConfiguration

  data:
    mongodb:
      # SECURE DEFAULT: Localhost (No Auth) - Safe for dev
      # PRODUCTION: WE WILL READ 'MONGODB_URI' FROM ENVIRONMENT
      uri: ${MONGODB_URI:mongodb://localhost:27017/mercenary}
  servlet:
    multipart:
      max-file-size: 50MB
      max-request-size: 50MB
  ai:
    ollama:
      base-url: ${OLLAMA_URL:http://localhost:11434}
      chat:
        options:
          model: ${LLM_MODEL:llama3}
          temperature: 0.7
      embedding:
        model: ${EMBEDDING_MODEL:nomic-embed-text}
    vectorstore:
      mongodb:
        atlas:
          collection-name: vector_store
          initialize-schema: true
          path-name: embedding
          index-name: vector_index

# ============================================
# Custom App Config
# ============================================
app:
  db-init: true
  # Authentication mode: DEV, OIDC, or CAC
  auth-mode: ${AUTH_MODE:DEV}

# ============================================
# SENTINEL Advanced RAG Configuration
# Based on cutting-edge research papers
# ============================================
sentinel:
  # RAGPart Defense (arXiv:2512.24268v1)
  # Corpus poisoning defense via document partitioning
  ragpart:
    enabled: ${RAGPART_ENABLED:true}
    partitions: ${RAGPART_PARTITIONS:4}
    combination-size: ${RAGPART_COMBINATION_SIZE:3}
    suspicion-threshold: ${RAGPART_SUSPICION_THRESHOLD:0.4}

  # HGMem - HyperGraph Memory (arXiv:2512.23959v2)
  # Multi-step RAG with complex relational modeling
  hgmem:
    enabled: ${HGMEM_ENABLED:true}
    max-memory-points: ${HGMEM_MAX_POINTS:50}
    merge-similarity-threshold: ${HGMEM_MERGE_THRESHOLD:0.7}

  # HiFi-RAG Pipeline (arXiv:2512.22442v1)
  # Hierarchical filtering + two-pass generation
  hifirag:
    enabled: ${HIFIRAG_ENABLED:true}
    initial-retrieval-k: ${HIFIRAG_INITIAL_K:20}
    filtered-top-k: ${HIFIRAG_FILTERED_K:5}
    relevance-threshold: ${HIFIRAG_RELEVANCE_THRESHOLD:0.5}
    max-iterations: ${HIFIRAG_MAX_ITERATIONS:2}
    reranker:
      batch-size: ${HIFIRAG_RERANKER_BATCH:5}
      timeout-seconds: ${HIFIRAG_RERANKER_TIMEOUT:30}
      use-llm: ${HIFIRAG_USE_LLM:true}

  # PII Redaction Engine
  # Industry-standard compliance: NIST 800-122, GDPR, HIPAA Safe Harbor, PCI-DSS
  pii:
    enabled: ${PII_ENABLED:true}
    mode: ${PII_MODE:MASK}  # MASK, TOKENIZE, or REMOVE
    audit-redactions: ${PII_AUDIT:true}
    patterns:
      ssn: ${PII_SSN:true}
      email: ${PII_EMAIL:true}
      phone: ${PII_PHONE:true}
      credit-card: ${PII_CREDIT_CARD:true}
      dob: ${PII_DOB:true}
      ip-address: ${PII_IP:true}
      passport: ${PII_PASSPORT:true}
      drivers-license: ${PII_DL:true}
      names: ${PII_NAMES:true}
      address: ${PII_ADDRESS:true}
      medical-id: ${PII_MEDICAL:true}

  # Glass Box Reasoning Engine
  # Real-time pipeline transparency
  reasoning:
    enabled: ${REASONING_ENABLED:true}
    detailed-traces: ${REASONING_DETAILED:false}
    trace-retention-hours: ${REASONING_RETENTION:24}

# ============================================
# Swagger/OpenAPI Configuration
# ============================================
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html
    enabled: ${SWAGGER_ENABLED:true}
    operationsSorter: method
    tagsSorter: alpha
    filter: true
    showExtensions: true
    showCommonExtensions: true
  show-actuator: false

# ============================================
# Profile-specific configurations
# ============================================

---
# DEVELOPMENT PROFILE (default)
spring:
  config:
    activate:
      on-profile: dev

app:
  auth-mode: DEV

---
# ENTERPRISE PROFILE (Azure AD / Okta)
spring:
  config:
    activate:
      on-profile: enterprise

app:
  auth-mode: OIDC
  oidc:
    issuer: ${OIDC_ISSUER}
    client-id: ${OIDC_CLIENT_ID}
    jwks-uri: ${OIDC_JWKS_URI:}
    local-jwks-path: ${OIDC_LOCAL_JWKS:}
    jwks-cache-ttl: ${OIDC_JWKS_CACHE_TTL:3600}
    allowed-algorithms: ${OIDC_ALGORITHMS:RS256,RS384,RS512,ES256}
    clock-skew-seconds: ${OIDC_CLOCK_SKEW:60}
    validate-issuer: ${OIDC_VALIDATE_ISSUER:true}
    validate-audience: ${OIDC_VALIDATE_AUDIENCE:true}
    auto-provision: ${OIDC_AUTO_PROVISION:true}
    default-role: ${OIDC_DEFAULT_ROLE:VIEWER}
    default-clearance: ${OIDC_DEFAULT_CLEARANCE:UNCLASSIFIED}

---
# GOVERNMENT/GOVCLOUD PROFILE (CAC/PIV)
spring:
  config:
    activate:
      on-profile: govcloud

app:
  auth-mode: CAC

# For air-gapped deployments, override MongoDB URI:
# MONGODB_URI=mongodb://localhost:27017/mercenary

---
# COMMERCIAL/STANDARD PROFILE (Username/Password)
spring:
  config:
    activate:
      on-profile: standard

app:
  auth-mode: STANDARD

sentinel:
  bootstrap:
    enabled: true
    admin-password: ${SENTINEL_ADMIN_PASSWORD:Sentinel-Deploy-2026}